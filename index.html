<html>
<head>
<title>KmbETA - DB</title>
<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
<script>
var db = null;

function load(){
	$.ajax({
		url: "https://db.kmbeta.ml/kmbeta_db.json",
		type: "GET",
		dataType: "json",
		async: true,
		error: function(){
			$("#status").html("Failed to fetch database.");
		},
		success: function(data){
			db = data;
			$("#status").html("Available");
			$("#time").html(db.generated);
			$("#date").html(db.generated_human);
			
			$("#numbuses").html(db.routes.length);
			$("#numroutes").html(db.buses.length);
			
			var node = document.getElementById("buses");
			node.innerHTML = "<ul>";
			for (var i = 0; i < db.buses.length; i++){
				node.innerHTML += "<li>" + db.buses[i].name + "</li>";
			}
			node.innerHTML += "</ul>";
		}
	});
}

function update(){
	if (db == null){
		$("#input").html("N/A");
		$("#routestatus").html("N/A");
		$("#stops").html("N/A");
		return;
	}
	
	var index = -1;
	for (var i = 0; i < db.buses.length; i++){
		if (db.buses[i].name == $("#input").val()){
			index = i;
		}
	}
	
	if (index == -1){
		$("#routestatus").html("Not found");
		$("#stops").html("Not found");
		return;
	}
}
</script>
</head>
<body onload="load()">
<a href="https://github.com/mob41/KmbETA-DB"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
<!-- This code is so so dirty. Onload function should not be inline. I will change it afterwards. -->
<table border="0" width="100%">
	<tr>
		<td style="background-color:#ffb3b3">
			<br/>
			<img src="kmbeta-icon.fw.png"></img><br/>
		</td>
	<tr>
	<tr>
		<td>
		</td>
	</tr>
	<tr>
		<td style="background-color:#ffb3b3">
			&nbsp;
		</td>
	</tr>
	<tr>
		<td style="background-color:#ffe6e6">
			<h1>KmbETA Pre-built database</h1>
				<p>This database is compatible for Java, JavaScript version of KmbETA-API.</p>
				<p>Database is hosted on GitHub. <a href="http://db.kmbeta.ml/kmbeta_db.json">http://db.kmbeta.ml/kmbeta_db.json</a>
				<p>This page is not completed. Layout, HTML coding are so dirty.</p>
				<p>This is just for testing. Don't blame me so much.</p>
			<h2>Status</h2>
				<p>Database status: <div id="status">Loading database... it might take a while</div></p>
				<p>Last update (ms): <div id="time">N/A</div></p>
				<p>Last update (Date): <div id="date">N/A</div></p>
			<h2>Bus information</h2>
				<p>Type the route name, and a list of bus stops will be shown.</p>
				<p>Route name: <div id="input"><input type="text" id="routeName" onkeypress="update()" onchange="update()" value="" /></div></p>
				<p>Status: <div id="routestatus">N/A</div></p>
				<p>List of bus stops:</p>
				<div id="stops">N/A</div>
			<h2>Database information</h2>
				<p>Number of buses: <div id="numbuses">N/A</div></p>
				<p>Number of routes downloaded: <div id="numroutes">N/A</div></p>
				<p>Available buses:</p>
				<div id="buses">N/A</div>
		</td>
	</tr>
	<tr>
		<td style="background-color:#ffb3b3; text-align:center">
			Copyright(c) 2016. mob41
		</td>
	</tr>
</table>
</body>
</html>
